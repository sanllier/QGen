all: qgen

OBJECTS = obj/qgen.o obj/qindivid_base.o \
          obj/qindivid_cpu.o obj/qindivid_gpu.o \
          obj/qobservestate.o obj/qrotoperator.o \
          obj/gpu_rand.o obj/pugixml.o \
          obj/mpicheck.o obj/mtrand.o obj/kernels.o
DFLAG      = -DGPU
CFLAG      = -Iinclude/ -O3
CUDA       = -I/opt/cuda/cuda-6.5/include
CC         = mpicxx
CUDACC     = g++
CUDACFLAGS = -Iinclude/ -O3

qgen: $(OBJECTS)
	@mkdir -p lib
	@echo "\033[30;1;41m "lib" dir created \033[0m"
	@ar rs lib/QGen_gpu.a $(OBJECTS)
	@echo "\033[30;1;41m QGen builded successfully! \033[0m"
	@echo "\033[30;1;41m --> lib/QGen_gpu.a \033[0m\n"

obj/qgen.o: src/qgen.cpp
	mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/qindivid_base.o: src/qindivid_base.cpp
	@mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/qindivid_cpu.o: src/qindivid_base.cpp
	@mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/qindivid_gpu.o: src/qindivid_base.cpp
	@mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/qobservestate.o: src/qobservestate.cpp
	@mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $(CUDA) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/qrotoperator.o: src/qrotoperator.cpp
	@mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/gpu_rand.o: src/gpu_rand.cpp
	@mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $(CUDA) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/pugixml.o: src/pugixml.cpp
	@mkdir -p obj
	@$(CC) -c $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/mpicheck.o: src/mpicheck.cpp
	@mkdir -p obj
	@$(CC) -c $(DFLAG) $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/mtrand.o: src/mtrand.cpp
	@mkdir -p obj
	@$(CC) -c $(CFLAG) $^ -o $@
	@echo "\033[30;1;46m $@ - done \033[0m\n"

obj/kernels.o: src/kernels.cu
	@nvcc -ccbin=$(CUDACC) -arch=sm_20 -maxrregcount=21 $(CUDACFLAGS) $< -c -o $@	
	@echo "\033[30;1;46m $@ - done \033[0m\n"

clean:
	rm -r -f lib
	rm -r -f obj